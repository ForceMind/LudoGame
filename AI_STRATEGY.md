# Ludo 游戏 AI 平衡策略逻辑 (V2.0)

为了保证游戏的趣味性并控制玩家的长期胜率维持在 50% 左右，我们采用了一套基于 **预测胜率** 和 **动态概率控制** 的复杂系统。

## 1. 核心公式：玩家预测胜率
系统实时计算玩家当前的预测胜率，公式如下：

$$
\text{预测胜率} = \frac{0.5 \times \text{结构分} + 0.5 \times \text{进度分}}{100}
$$

### 1.1 结构分 (Structure Score)
反映玩家棋子的分布状态：

$$
\text{结构分} = \text{在家棋子} \times 5 + \text{在路上棋子} \times 15 + \text{安全区棋子} \times 20 + \text{到达终点} \times 25
$$

*(注：满分 100 分)*

### 1.2 进度分 (Progress Score)
反映玩家距离胜利的接近程度：

$$
\text{进度分} = \left( 1 - \frac{\text{所有棋子剩余步数总和}}{\text{总步数 (224)}} \right) \times 100
$$

## 2. 骰子概率控制模型
在玩家掷骰子时，系统根据 **胜率差值** 和 **历史战绩** 动态调整点数概率。

### 2.1 参数定义
*   **用户平均胜率**: 当前局所有玩家（含 Bot）的预测胜率平均值。
*   **胜率差值**: `玩家预测胜率 - 用户平均胜率`。
*   **基础胜率平衡值**: `最近100局胜率 - 50%`。

### 2.2 概率计算 (Sigmoid 模型)
将骰子点数分为两组：
*   **A 组**: {1, 2, 3, 4, 5}
*   **B 组**: {6}

计算影响参数：

$$
\text{影响参数} = \text{胜率差值} + \text{基础胜率平衡值} + 1.6
$$

A 组出现的概率：

$$
P(A) = \frac{e^{\text{影响参数}}}{1 + e^{\text{影响参数}}}
$$

*   当玩家优势大或历史胜率高时，`影响参数` 变大，$P(A)$ 变大，掷出 6 的概率降低。
*   当玩家劣势大或历史胜率低时，`影响参数` 变小，$P(A)$ 变小，掷出 6 的概率提高。

## 3. 特殊干预机制

### 3.1 打人干预 (Capture Intervention)
当玩家掷骰子前，系统会检测是否存在潜在的吃子机会（即掷出特定点数可吃掉敌方棋子）。如果存在，系统将计算 **干预概率** 来决定是否“赠送”这个点数。

#### 3.1.1 基础概率计算
基于 Sigmoid 函数变体，胜率越高，获得帮助的概率越低。

$$
\text{综合影响因子 (Influence)} = \text{胜率差值} + \text{基础胜率平衡值}
$$

$$
\text{参数 (Param)} = 0.4 - \text{Influence}
$$

$$
P_{\text{base}} = \frac{1}{1 + e^{-\text{Param}}}
$$

#### 3.1.2 时间流逝系数 (Time Coefficient)
为了控制游戏节奏（目标时长约 10 分钟），引入时间系数 $C_t$ 对基础概率进行修正。

设游戏时长为 $t$ (分钟)：

*   **发育期 ($t < 2$)**: $C_t = 0.3$ (降低冲突，平稳开局)
*   **升温期 ($2 \le t < 4$)**: $C_t$ 从 0.3 线性增加至 1.0
    $$ C_t = 0.3 + 0.7 \times \frac{t-2}{2} $$
*   **激战期 ($4 \le t < 6$)**: $C_t = 1.0$ (全速推进，鼓励吃子)
*   **收官期 ($6 \le t < 9$)**: $C_t$ 从 1.0 线性降低至 0.2
    $$ C_t = 1.0 - 0.8 \times \frac{t-6}{3} $$
*   **终局 ($t \ge 9$)**: $C_t = 0.2$ (强力抑制吃子，促使棋子归位结束游戏)

#### 3.1.3 最终触发概率
$$
P_{\text{final}} = P_{\text{base}} \times C_t
$$

系统生成一个 0-1 之间的随机数，如果小于 $P_{\text{final}}$，则直接掷出能吃子的点数。

### 3.2 终点干预 (End Game Intervention)
当玩家只剩最后一个棋子未完成，且距离终点 $\le 14$ 步时，进入终点干预模式。
骰子分为两组：
*   **A 组**: {3, 5, 6} (快速/大点数)
*   **B 组**: {1, 2, 4} (慢速/小点数)

根据 **基础胜率平衡值** (历史胜率偏移) 决定概率：
*   `> 10%` (胜率 > 60%): 100% 概率使用 A 组。
*   `> 0%` (胜率 > 50%): 80% 概率使用 A 组。
*   `< 0%` (胜率 < 50%): 20% 概率使用 A 组 (即 80% B 组)。
*   `< -8%` (胜率 < 42%): 0% 概率使用 A 组 (即 100% B 组)。

*(注：此机制用于在最后关头根据玩家长期表现进行“制裁”或“放水”)*
