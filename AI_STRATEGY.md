# Ludo 游戏 AI 平衡策略逻辑 (V2.0)

为了保证游戏的趣味性并控制玩家的长期胜率维持在 50% 左右，我们采用了一套基于 **预测胜率** 和 **动态概率控制** 的复杂系统。

## 1. 核心公式：玩家预测胜率
系统实时计算玩家当前的预测胜率，公式如下：

$$
\text{预测胜率} = \frac{0.5 \times \text{结构分} + 0.5 \times \text{进度分}}{100}
$$

### 1.1 结构分 (Structure Score)
反映玩家棋子的分布状态：

$$
\text{结构分} = \text{在家棋子} \times 5 + \text{在路上棋子} \times 15 + \text{安全区棋子} \times 20 + \text{到达终点} \times 25
$$

*(注：满分 100 分)*

### 1.2 进度分 (Progress Score)
反映玩家距离胜利的接近程度：

$$
\text{进度分} = \left( 1 - \frac{\text{所有棋子剩余步数总和}}{\text{总步数 (224)}} \right) \times 100
$$

## 2. 骰子概率控制模型
在玩家掷骰子时，系统根据 **胜率差值** 和 **历史战绩** 动态调整点数概率。

### 2.1 参数定义
*   **用户平均胜率**: 当前局所有玩家（含 Bot）的预测胜率平均值。
*   **胜率差值**: `玩家预测胜率 - 用户平均胜率`。
*   **基础胜率平衡值**: `最近100局胜率 - 50%`。

### 2.2 概率计算 (Sigmoid 模型)
将骰子点数分为两组：
*   **A 组**: {1, 2, 3, 4, 5}
*   **B 组**: {6}

计算影响参数：

$$
\text{影响参数} = \text{胜率差值} + \text{基础胜率平衡值} + 1.6
$$

A 组出现的概率：

$$
P(A) = \frac{e^{\text{影响参数}}}{1 + e^{\text{影响参数}}}
$$

*   当玩家优势大或历史胜率高时，`影响参数` 变大，$P(A)$ 变大，掷出 6 的概率降低。
*   当玩家劣势大或历史胜率低时，`影响参数` 变小，$P(A)$ 变小，掷出 6 的概率提高。

### 2.3 游戏节奏加速机制 (Pacing Control)
为了将单局游戏时长控制在 10 分钟以内，系统引入了以下加速逻辑：

#### 2.3.1 开局加速 (Opening Boost)
当玩家在基地内的棋子数量 $\ge 3$ 时（即开局阶段），系统会强制降低 `影响参数`：
$$
\text{影响参数} = \text{影响参数} - 0.5
$$
这会显著提高掷出 6 的概率，帮助玩家和 Bot 更快起飞。

#### 2.3.2 移动加速 (Movement Boost)
当系统决定掷出 **A 组** (1-5) 点数时，为了加快游戏节奏同时避免小点数过难出现，采用 **分组加权** 策略：

*   **高速组 {3, 4, 5}**: 80% 概率选中。
*   **低速组 {1, 2}**: 20% 概率选中。

这使得大点数出现的概率显著增加（约 26.6%），而小点数仍保留约 10% 的出现率，避免了单纯取最大值导致 1 点极难出现的问题。

## 3. 特殊干预机制

### 3.1 打人干预 (Capture Intervention)
当玩家掷骰子前，系统会检测是否存在潜在的吃子机会（即掷出特定点数可吃掉敌方棋子）。如果存在，系统将计算 **干预概率** 来决定是否“赠送”这个点数。

#### 3.1.1 基础概率计算
基于 Sigmoid 函数变体，胜率越高，获得帮助的概率越低。

$$
\text{综合影响因子 (Influence)} = \text{胜率差值} + \text{基础胜率平衡值}
$$

$$
\text{参数 (Param)} = 0.4 - \text{Influence}
$$

$$
P_{\text{base}} = \frac{1}{1 + e^{-\text{Param}}}
$$

#### 3.1.2 回合进度系数 (Turn Count Coefficient)
为了更精准地控制游戏节奏（避免因玩家思考时间不同导致的时间偏差），系统改用 **回合数 (Turn Count)** 来划分游戏阶段。

设当前总回合数为 $T$：

*   **发育期 ($T < 20$)**: $C_t = 0.3$ (降低冲突，平稳开局)
*   **升温期 ($20 \le T < 40$)**: $C_t$ 从 0.3 线性增加至 1.0。
*   **激战期 ($40 \le T < 80$)**: $C_t = 1.0$ (全速推进，鼓励吃子)
*   **收官期 ($80 \le T < 120$)**: $C_t$ 从 1.0 线性降低至 0.2。
*   **终局 ($T \ge 120$)**: $C_t = 0.2$ (强力抑制吃子，促使棋子归位结束游戏)

#### 3.1.3 最终触发概率
$$
P_{\text{final}} = P_{\text{base}} \times C_t
$$

系统生成一个 0-1 之间的随机数，如果小于 $P_{\text{final}}$，则直接掷出能吃子的点数。

### 3.2 防御性干预 (Anti-Capture Intervention)
为了保护处于劣势的玩家，以及在终局阶段加速游戏结束，系统引入了防御机制。

#### 3.2.1 弱势保护
*   **触发条件**: 受害者处于 **劣势状态** (胜率差值 < -5%)。
*   **效果**: 强制重掷骰子，避免其被吃。

#### 3.2.2 终局加速保护 (Endgame Acceleration)
*   **触发条件**: 
    1.  游戏回合数 > 60 (进入后期)。
    2.  受害者处于 **优势状态** (即将获胜，已完成棋子 $\ge 2$ 或 胜率差值 > 0)。
    3.  受害者优势未过大 (胜率差值 < 40%，防止过度碾压)。
    4.  **新增限制**: 受害者的 **最近胜率** (Recent Win Rate) 必须 $\le 60\%$。如果玩家长期胜率过高，系统将不再提供此保护，让其凭实力获胜。
*   **目的**: 保护领先者不被意外吃子打断节奏，从而让游戏尽快结束，开启下一局。同时防止高胜率玩家利用此机制“刷分”。

### 3.3 基地救援机制 (Base Rescue)
为了防止玩家因运气差导致棋子长期滞留基地（挫败感强）：
*   **触发条件**: 玩家在基地内的棋子数量 $\ge 2$。
*   **效果**: 大幅降低 `Influence` 参数 (-0.8)，显著提高掷出 **6** 点的概率。
*   **目的**: 帮助玩家快速起飞，参与游戏互动。

### 3.4 终点干预 (End Game Intervention)
当玩家只剩最后一个棋子未完成，且距离终点 $\le 14$ 步时，进入终点干预模式。
骰子分为两组：
*   **A 组**: {3, 5, 6} (快速/大点数)
*   **B 组**: {1, 2, 4} (慢速/小点数)

根据 **基础胜率平衡值** (历史胜率偏移) 决定概率：
*   `> 10%` (胜率 > 60%): 100% 概率使用 A 组。
*   `> 0%` (胜率 > 50%): 80% 概率使用 A 组。
*   `< 0%` (胜率 < 50%): 20% 概率使用 A 组 (即 80% B 组)。
*   `< -8%` (胜率 < 42%): 0% 概率使用 A 组 (即 100% B 组)。

*(注：此机制用于在最后关头根据玩家长期表现进行“制裁”或“放水”)*
